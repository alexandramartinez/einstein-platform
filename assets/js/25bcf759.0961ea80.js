"use strict";(self.webpackChunkcookbook=self.webpackChunkcookbook||[]).push([[6650],{81321:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var t=o(74848),s=o(28453);const r={slug:"aws",authors:["rsexton"],tags:["aws","bedrock","llm-open-connector"],date:new Date("2024-09-13T00:00:00.000Z")},i="LLM Open Connector + AWS",l={permalink:"/einstein-platform/aws",source:"@site/cookbook/llm-open-connector-aws.md",title:"LLM Open Connector + AWS",description:"Learn how to implement Salesforce's LLM Open Connector using Amazon Web Services (AWS). We use Amazon Bedrock to host a Llama model from Meta, a Lambda for serverless compute, and an API Gateway to expose our API.",date:"2024-09-13T00:00:00.000Z",tags:[{inline:!1,label:"aws",permalink:"/einstein-platform/tags/aws"},{inline:!1,label:"bedrock",permalink:"/einstein-platform/tags/bedrock"},{inline:!1,label:"llm-open-connector",permalink:"/einstein-platform/tags/llm-open-connector"}],readingTime:4.24,hasTruncateMarker:!0,authors:[{name:"Richard",title:"Technical Writer @ Salesforce",url:"https://github.com/rsexton404",page:{permalink:"/einstein-platform/authors/rsexton"},socials:{github:"https://github.com/rsexton404"},imageURL:"https://github.com/rsexton404.png",key:"rsexton"}],frontMatter:{slug:"aws",authors:["rsexton"],tags:["aws","bedrock","llm-open-connector"],date:"2024-09-13T00:00:00.000Z"},unlisted:!1,prevItem:{title:"Introducing the LLM Open Connector",permalink:"/einstein-platform/open-connector"},nextItem:{title:"LLM Open Connector + Groq",permalink:"/einstein-platform/groq"}},a={authorsImageUrls:[void 0]},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Set Up AWS Bedrock and Model Access",id:"set-up-aws-bedrock-and-model-access",level:2},{value:"Installation",id:"installation",level:2},{value:"Project Structure",id:"project-structure",level:2},{value:"Deployment",id:"deployment",level:2},{value:"Usage",id:"usage",level:2},{value:"Example using cUrl",id:"example-using-curl",level:3},{value:"Testing with a Web UI",id:"testing-with-a-web-ui",level:2},{value:"Notes",id:"notes",level:2},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["Learn how to implement Salesforce's ",(0,t.jsx)(n.a,{href:"/docs/apis/llm-open-connector/",children:"LLM Open Connector"})," using Amazon Web Services (AWS). We use Amazon Bedrock to host a Llama model from Meta, a Lambda for serverless compute, and an API Gateway to expose our API."]}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"AWS Account with appropriate permissions"}),"\n",(0,t.jsxs)(n.li,{children:["AWS CLI. For installation instructions, see ",(0,t.jsx)(n.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html",children:"Install or update to the latest version of the AWS CLI"})," and ",(0,t.jsx)(n.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/getting-started-quickstart.html",children:"Set up the AWS CLI"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Python 3.9 or later"}),"\n",(0,t.jsxs)(n.li,{children:["AWS CDK installed (",(0,t.jsx)(n.code,{children:"npm install -g aws-cdk"}),")"]}),"\n",(0,t.jsx)(n.li,{children:"Access to AWS Bedrock (you may need to request access if it's not enabled in your account)"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"set-up-aws-bedrock-and-model-access",children:"Set Up AWS Bedrock and Model Access"}),"\n",(0,t.jsx)(n.p,{children:"Before deploying and using the LLM Open Connector, you need to set up access to AWS Bedrock and enable the specific model you want to use. Follow these steps:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Enable AWS Bedrock:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Go to the ",(0,t.jsx)(n.a,{href:"https://console.aws.amazon.com/bedrock",children:"AWS Bedrock console"}),"."]}),"\n",(0,t.jsx)(n.li,{children:'If you see a "Get started" button, click it to enable Bedrock for your account.'}),"\n",(0,t.jsx)(n.li,{children:"If Bedrock is already enabled, you'll see the Bedrock dashboard."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request access to models:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'In the Bedrock console, go to "Model access" in the left navigation pane.'}),"\n",(0,t.jsx)(n.li,{children:"Find the model you want to use (for example, Llama 3.1 70B Instruct)."}),"\n",(0,t.jsx)(n.li,{children:'Click the menu (three dots) and select "Request model access".'}),"\n",(0,t.jsxs)(n.li,{children:["Verify that the model is selected and click ",(0,t.jsx)(n.strong,{children:"Next"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Read and accept the terms and conditions, then click ",(0,t.jsx)(n.strong,{children:"Submit"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Wait for your request to be approved. This is usually instant for most models."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Create a new local directory for your project and navigate to it:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"mkdir aws-bedrock-llama-connector\ncd aws-bedrock-llama-connector\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Download from the einstein-platform repository:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/salesforce/einstein-platform/tree/main/documentation/cookbook-assets/llm-open-connector-aws/lib/aws_bedrock_llama_connector_stack.py",children:"lib/aws_bedrock_llama_connector_stack.py"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/salesforce/einstein-platform/tree/main/documentation/cookbook-assets/llm-open-connector-aws/lambda/handler.py",children:"lambda/handler.py"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/salesforce/einstein-platform/tree/main/documentation/cookbook-assets/llm-open-connector-aws/app.py",children:"app.py"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/salesforce/einstein-platform/tree/main/documentation/cookbook-assets/llm-open-connector-aws/cdk.json",children:"cdk.json"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/salesforce/einstein-platform/tree/main/documentation/cookbook-assets/llm-open-connector-aws/index.html",children:"index.html"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/salesforce/einstein-platform/tree/main/documentation/cookbook-assets/llm-open-connector-aws/requirements.txt",children:"requirements.txt"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Copy the downloaded files into your project directory."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Create a virtual environment and install Python dependencies:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"python -m venv venv\nsource venv/bin/activate  # On Windows, use `venv\\Scripts\\activate`\npip install -r requirements.txt\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"project-structure",children:"Project Structure"}),"\n",(0,t.jsx)(n.p,{children:"Your project structure should now look like this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"aws-bedrock-llama-connector/\n\u251c\u2500\u2500 lib/\n\u2502   \u2514\u2500\u2500 aws_bedrock_llama_connector_stack.py\n\u251c\u2500\u2500 lambda/\n\u2502   \u2514\u2500\u2500 handler.py\n\u251c\u2500\u2500 app.py\n\u251c\u2500\u2500 cdk.json\n\u251c\u2500\u2500 index.html\n\u2514\u2500\u2500 requirements.txt\n"})}),"\n",(0,t.jsx)(n.h2,{id:"deployment",children:"Deployment"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Configure AWS CLI with your credentials:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"aws configure\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Bootstrap your AWS environment (if you haven't already):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"cdk bootstrap\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Deploy the stack:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"cdk deploy\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"After deployment, CDK will output the API Gateway URL. You can use this URL to make requests to your Llama model."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,t.jsxs)(n.p,{children:["To use the deployed API, send a POST request to the ",(0,t.jsx)(n.code,{children:"/chat/completions"})," endpoint with the following JSON structure:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "messages": [\n    { "role": "system", "content": "You are a helpful assistant." },\n    { "role": "user", "content": "Tell me a joke about programming." }\n  ],\n  "temperature": 0.7\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"You can use tools like cUrl, Postman, or any programming language to make HTTP requests to your API."}),"\n",(0,t.jsx)(n.h3,{id:"example-using-curl",children:"Example using cUrl"}),"\n",(0,t.jsx)(n.p,{children:"Here's an example cUrl command to test your API:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl -X POST https://your-api-id.execute-api.your-region.amazonaws.com/prod/chat/completions \\\n-H "Content-Type: application/json" \\\n-d \'{\n  "messages": [\n    {"role": "system", "content": "You are a helpful assistant."},\n    {"role": "user", "content": "Tell me a joke about programming."}\n  ],\n  "temperature": 0.7\n}\'\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Replace ",(0,t.jsx)(n.code,{children:"https://your-api-id.execute-api.your-region.amazonaws.com/prod"})," with the actual URL of your deployed API Gateway, which you can find in the AWS Console or in the output of the ",(0,t.jsx)(n.code,{children:"cdk deploy"})," command."]}),"\n",(0,t.jsx)(n.p,{children:"This cUrl command sends a POST request to your API with the specified JSON payload. The API should respond with a JSON object containing the generated text from the Llama model."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note"}),": If you're using Windows Command Prompt, you may need to escape the double quotes in the JSON payload differently. For PowerShell or bash on Windows (e.g., Git Bash), the command should work as written above."]}),"\n",(0,t.jsx)(n.h2,{id:"testing-with-a-web-ui",children:"Testing with a Web UI"}),"\n",(0,t.jsxs)(n.p,{children:["Use the included ",(0,t.jsx)(n.a,{href:"https://github.com/salesforce/einstein-platform/tree/main/documentation/cookbook-assets/llm-open-connector-aws/index.html",children:"index.html"})," file to test your API gateway with a web UI."]}),"\n",(0,t.jsxs)(n.p,{children:["Before using the web UI, edit the file and replace ",(0,t.jsx)(n.code,{children:"https://your-api-id.execute-api.your-region.amazonaws.com/prod"})," with the actual URL of your deployed API Gateway, which you can find in the AWS Console or in the output of the ",(0,t.jsx)(n.code,{children:"cdk deploy"})," command."]}),"\n",(0,t.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["This cookbook uses the ",(0,t.jsx)(n.code,{children:"meta.llama3-1-70b-instruct-v1:0"})," model as a placeholder. You can replace it with any supported model that you have been granted access to in Amazon Bedrock. For a list of supported model IDs, see ",(0,t.jsx)(n.a,{href:"https://docs.aws.amazon.com/bedrock/latest/userguide/model-ids.html",children:"Amazon Bedrock model IDs"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"The token count in the response is set to -1 as AWS Bedrock doesn't provide token usage information. You may need to implement your own token counting logic if required."}),"\n",(0,t.jsx)(n.li,{children:"Error handling and input validation should be improved for production use."}),"\n",(0,t.jsx)(n.li,{children:"Consider disabling CORS."}),"\n",(0,t.jsx)(n.li,{children:"Consider implementing authentication and rate limiting for your API Gateway."}),"\n",(0,t.jsx)(n.li,{children:"Monitor your AWS usage to manage costs, especially if you expect high traffic."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,t.jsx)(n.p,{children:"This cookbook demonstrates how to set up an LLM Open Connector using AWS Bedrock, Lambda, and API Gateway. It provides a serverless, scalable solution for integrating Llama models into your applications. Remember to optimize your implementation based on your specific requirements and expected usage patterns."})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,o)=>{o.d(n,{R:()=>i,x:()=>l});var t=o(96540);const s={},r=t.createContext(s);function i(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);